import{w as s,d as e,e as t,b as a,q as n}from"./with-resolvers-DgdAhYQ2.js";import{i as r}from"./i32-C78nBJH2.js";import{p as o,q as c,d as i,b as h,u,S as f,T as l,g as p,r as b,l as g,B as y,F as m,h as d,j as w,i as k,E as A,k as B,M as U,D as x,n as j,V as v,N as q,U as O,o as S,f as L,Z as M,c as N,e as F,I,R as E,a as R,O as z,A as D}from"./channel-CC7a8JrL.js";import{a as P}from"./global-D1K2q6W8.js";import{b as _}from"./shared-D1EE5wug.js";const{isArray:J}=Array,T=s=>s;class K extends Worker{#s;#e;constructor(s,e){super(s,e),this.#s=r(),this.#e=new Map,e.onsend||(e.onsend=T),super.addEventListener("message",async s=>{const{data:t}=s;if(J(t)&&2===t.length&&t[0]===o){s.stopImmediatePropagation(),s.preventDefault();const[a,n]=t[1],r=this.#e.get(a);this.#e.delete(a),r(await e.onsend(n))}})}send(e,...t){const a=this.#s(),{promise:n,resolve:r}=s();return this.#e.set(a,r),super.postMessage([o,[a,e]],...t),n}}class V{static push(s,e){s.sync(!1),s._(e,e.length)}constructor(s,e){const t=[];this.l=0,this.o=t,this.v=new Uint8Array(s,e),this.push=t.push.bind(t)}get length(){return this.l+this.o.length}sync(s){const e=this.o,t=e.length;t&&this._(s?e:e.splice(0),t)}_(s,e){const{buffer:t,byteOffset:a}=this.v,n=this.l;this.l+=e,e+=a+n,t.byteLength<e&&t.grow(e),this.v.set(s,n)}}const{isNaN:W,isFinite:Z,isInteger:C}=Number,{ownKeys:G}=Reflect,{is:H}=Object,Q=(s,e,t)=>{const a=t.get(s),n=!a;return n?(i.setUint32(0,e.length,!0),t.set(s,[u[0],u[1],u[2],u[3]])):e.push(E,a[0],a[1],a[2],a[3]),n},X=(s,e,t)=>{i.setUint32(0,t,!0),s.push(e,u[0],u[1],u[2],u[3])},Y=(s,n,r)=>{switch(typeof s){case"number":s&&Z(s)?C(s)&&s<256&&-1<s?n.push(O,s):(i.setFloat64(0,s,!0),n.push(S,u[0],u[1],u[2],u[3],u[4],u[5],u[6],u[7])):W(s)?n.push(L):s?n.push(s<0?F:I):n.push(H(s,0)?M:N);break;case"object":switch(!0){case null===s:n.push(q);break;case!Q(s,n,r):break;case a(s):{const e=s.length;X(n,D,e);for(let t=0;t<e;t++)Y(s[t],n,r);break}case t(s):if(n.push(v),Y(P(s),n,r),s=s.buffer,!Q(s,n,r))break;case s instanceof ArrayBuffer:{const e=new Uint8Array(s);X(n,j,e.length),ss(n,e);break}case s instanceof Date:n.push(x),Y(s.getTime(),n,r);break;case s instanceof Map:X(n,U,s.size);for(const[e,t]of s)Y(e,n,r),Y(t,n,r);break;case s instanceof Set:X(n,B,s.size);for(const e of s)Y(e,n,r);break;case s instanceof Error:n.push(A),Y(s.name,n,r),Y(s.message,n,r),Y(s.stack,n,r);break;case s instanceof w:n.push(k),Y(s.data,n,r),Y(s.width,n,r),Y(s.height,n,r),Y(s.colorSpace,n,r),Y(s.pixelFormat,n,r);break;case s instanceof RegExp:n.push(d),Y(s.source,n,r),Y(s.flags,n,r);break;case s instanceof File:n.push(m),Y(s.name,n,r),Y(s.lastModified,n,r);case s instanceof Blob:{const e=s.size;n.push(y),Y(s.type,n,r),Y(e,n,r);const t=n.length;ss(n,new Uint8Array(e)),$.push(s.arrayBuffer().then(s=>[t,s]));break}default:if("toJSON"in s){const e=s.toJSON();Y(e===s?null:e,n,r)}else{const e=G(s),t=e.length;X(n,z,t);for(let a=0;a<t;a++){const t=e[a];Y(t,n,r),Y(s[t],n,r)}}}break;case"string":if(Q(s,n,r)){const e=b.encode(s);X(n,g,e.length),ss(n,e)}break;case"boolean":n.push(s?l:p);break;case"symbol":n.push(f),Y(e(s),n,r);break;case"bigint":{let e=h;9223372036854775807n<s?(i.setBigUint64(0,s,!0),e=R):i.setBigInt64(0,s,!0),n.push(e,u[0],u[1],u[2],u[3],u[4],u[5],u[6],u[7]);break}default:n.push(c)}},$=[];let ss=n;const es=({byteOffset:s=0,Array:e=V}={})=>(t,a)=>{const n=new e(a,s);ss=e.push,Y(t,n,new Map);const r=n.length;return n.sync(!0),$.length?Promise.all($.splice(0)).then(e=>{const t=new Uint8Array(a,s);for(const[s,a]of e)t.set(new Uint8Array(a),s);return r}):r},{notify:ts,store:as}=Atomics,ns=({initByteLength:s=1024,maxByteLength:e=8192})=>new SharedArrayBuffer(_+s,{maxByteLength:_+e}),rs=e=>(t,a)=>{const{promise:n,resolve:r}=s();return new e(t,a,r),n},os=(s,e,t)=>{const a=new Int32Array(s),n=(e.encoder??es)({byteOffset:_}),r=t?s=>{as(a,1,s),as(a,0,1),ts(a,0)}:s=>{a[1]=s,a[0]=1};return async({data:t})=>(e=>{const t=n(e,s);return"number"==typeof t?r(t):t.then(r)})(await e.onsync(t))},cs=s=>{switch(typeof s){case"symbol":case"function":return!1}return!0},is=(s,e)=>{const t={};for(const s in e){const a=e[s];cs(s)&&cs(a)&&(t[s]=a)}return[s,t]},hs=(s,e,t)=>{const a=new URL(s,location.href);return a.searchParams.set("reflected",e),[a,{...t,type:"module"}]};export{K as S,ns as a,rs as b,os as h,is as p,hs as u};
