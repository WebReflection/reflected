import{w as s,e,I as t,h as a,c as n,q as r}from"./with-resolvers-BbzrtcFW.js";import{i as o}from"./i32-C78nBJH2.js";import{o as c,p as i,d as h,b as u,u as f,S as l,T as p,g as b,q as g,k as y,B as m,F as d,h as w,i as k,E as A,j as B,M as U,D as x,m as j,V as v,N as q,U as O,n as S,f as I,Z as L,c as M,e as N,I as F,R as E,a as R,O as z,A as D}from"./channel-DAX11UfC.js";import{t as P}from"./global-DKJApQIy.js";import{b as _}from"./shared-D1EE5wug.js";const{isArray:J}=Array,T=s=>s;class K extends Worker{#s;#e;constructor(s,e){super(s,e),this.#s=o(),this.#e=new Map,e.onsend||(e.onsend=T),super.addEventListener("message",async s=>{const{data:t}=s;if(J(t)&&2===t.length&&t[0]===c){s.stopImmediatePropagation(),s.preventDefault();const[a,n]=t[1],r=this.#e.get(a);this.#e.delete(a),r(await e.onsend(n))}})}send(e,...t){const a=this.#s(),{promise:n,resolve:r}=s();return this.#e.set(a,r),super.postMessage([c,[a,e]],...t),n}}class V{static push(s,e){s.sync(!1),s._(e,e.length)}constructor(s,e){const t=[];this.l=0,this.o=t,this.v=new Uint8Array(s,e),this.push=t.push.bind(t)}get length(){return this.l+this.o.length}sync(s){const e=this.o,t=e.length;t&&this._(s?e:e.splice(0),t)}_(s,e){const{buffer:t,byteOffset:a}=this.v,n=this.l;this.l+=e,e+=a+n,t.byteLength<e&&t.grow(e),this.v.set(s,n)}}const{isNaN:W,isFinite:Z,isInteger:C}=Number,{ownKeys:G}=Reflect,{is:H}=Object,Q=(s,e,t)=>{const a=t.get(s),n=!a;return n?(h.setUint32(0,e.length,!0),t.set(s,[f[0],f[1],f[2],f[3]])):e.push(E,a[0],a[1],a[2],a[3]),n},X=(s,e,t)=>{h.setUint32(0,t,!0),s.push(e,f[0],f[1],f[2],f[3])},Y=(s,r,o)=>{switch(typeof s){case"number":s&&Z(s)?C(s)&&s<256&&-1<s?r.push(O,s):(h.setFloat64(0,s,!0),r.push(S,f[0],f[1],f[2],f[3],f[4],f[5],f[6],f[7])):W(s)?r.push(I):s?r.push(s<0?N:F):r.push(H(s,0)?L:M);break;case"object":switch(!0){case null===s:r.push(q);break;case!Q(s,r,o):break;case n(s):{const e=s.length;X(r,D,e);for(let t=0;t<e;t++)Y(s[t],r,o);break}case a(s):if(r.push(v),Y(P(s),r,o),s=s.buffer,!Q(s,r,o))break;case s instanceof ArrayBuffer:{const e=new Uint8Array(s);X(r,j,e.length),ss(r,e);break}case s instanceof Date:r.push(x),Y(s.getTime(),r,o);break;case s instanceof Map:X(r,U,s.size);for(const[e,t]of s)Y(e,r,o),Y(t,r,o);break;case s instanceof Set:X(r,B,s.size);for(const e of s)Y(e,r,o);break;case s instanceof Error:r.push(A),Y(s.name,r,o),Y(s.message,r,o),Y(s.stack,r,o);break;case s instanceof t:r.push(k),Y(s.data,r,o),Y(s.width,r,o),Y(s.height,r,o),Y(s.colorSpace,r,o),Y(s.pixelFormat,r,o);break;case s instanceof RegExp:r.push(w),Y(s.source,r,o),Y(s.flags,r,o);break;case s instanceof File:r.push(d),Y(s.name,r,o),Y(s.lastModified,r,o);case s instanceof Blob:{const e=s.size;r.push(m),Y(s.type,r,o),Y(e,r,o);const t=r.length;ss(r,new Uint8Array(e)),$.push(s.arrayBuffer().then(s=>[t,s]));break}default:if("toJSON"in s){const e=s.toJSON();Y(e===s?null:e,r,o)}else{const e=G(s),t=e.length;X(r,z,t);for(let a=0;a<t;a++){const t=e[a];Y(t,r,o),Y(s[t],r,o)}}}break;case"string":if(Q(s,r,o)){const e=g.encode(s);X(r,y,e.length),ss(r,e)}break;case"boolean":r.push(s?p:b);break;case"symbol":r.push(l),Y(e(s),r,o);break;case"bigint":{let e=u;9223372036854775807n<s?(h.setBigUint64(0,s,!0),e=R):h.setBigInt64(0,s,!0),r.push(e,f[0],f[1],f[2],f[3],f[4],f[5],f[6],f[7]);break}default:r.push(i)}},$=[];let ss=r;const es=({byteOffset:s=0,Array:e=V}={})=>(t,a)=>{const n=new e(a,s);ss=e.push,Y(t,n,new Map);const r=n.length;return n.sync(!0),$.length?Promise.all($.splice(0)).then(e=>{const t=new Uint8Array(a,s);for(const[s,a]of e)t.set(new Uint8Array(a),s);return r}):r},{notify:ts,store:as}=Atomics,ns=({initByteLength:s=1024,maxByteLength:e=8192})=>new SharedArrayBuffer(_+s,{maxByteLength:_+e}),rs=e=>(t,a)=>{const{promise:n,resolve:r}=s();return new e(t,a,r),n},os=(s,e,t)=>{const a=new Int32Array(s),n=(e.encoder??es)({byteOffset:_}),r=t?s=>{as(a,1,s),as(a,0,1),ts(a,0)}:s=>{a[1]=s,a[0]=1};return async({data:t})=>(e=>{const t=n(e,s);return"number"==typeof t?r(t):t.then(r)})(await e.onsync(t))},cs=s=>{switch(typeof s){case"symbol":case"function":return!1}return!0},is=(s,e)=>{const t={};for(const s in e){const a=e[s];cs(s)&&cs(a)&&(t[s]=a)}return[s,t]},hs=(s,e,t)=>{const a=new URL(s,location.href);return a.searchParams.set("reflected",e),[a,{...t,type:"module"}]};export{K as S,ns as a,rs as b,os as h,is as p,hs as u};
