const e=Promise.withResolvers||function(){var e,t,s=new this((s,r)=>{e=s,t=r});return{resolve:e,reject:t,promise:s}};var t=e.bind(Promise),s=e=>{const t=new Int32Array(1);return()=>t[0]++},r="353932a0-9595-4ff9-9b6b-53b3f14ebbe3";const{isArray:n}=Array;class a extends Worker{#e;#t;constructor(e,t){super(e,t),this.#e=s(),this.#t=new Map,super.addEventListener("message",async e=>{const{data:s}=e;if(n(s)&&s[0]===r){e.stopImmediatePropagation(),e.preventDefault();const[r,n]=s[1],[a,o]=this.#t.get(r);this.#t.delete(r),a(await t.onsend(n,...o))}})}send(e,...s){const n=this.#e(),{promise:a,resolve:o}=t();return this.#t.set(n,[o,s]),super.postMessage([r,[n,e]],...s),a}}let{SharedArrayBuffer:o}=globalThis;try{new o(4,{maxByteLength:8})}catch(e){o=class extends ArrayBuffer{get growable(){return super.resizable}grow(e){super.resize(e)}}}const c=2*Int32Array.BYTES_PER_ELEMENT,i=e=>{switch(typeof e){case"symbol":case"function":return!1}return!0};let d=!0;try{crypto.randomUUID()}catch(e){d=!1}const u=d?()=>crypto.randomUUID():()=>(Date.now()+Math.random()).toString(36),p="async";var g=(e=>(s,r)=>{const{promise:n,resolve:a}=t();return new e(s,r,a),n})(class extends a{constructor(e,t,s){const r=u(),n=new BroadcastChannel(r),a=(({initByteLength:e=1024,maxByteLength:t=8192})=>new o(c+e,{maxByteLength:c+t}))(t),d=new Int32Array(a),g=((e,t)=>{const s=new Int32Array(e);return async({data:r})=>{const n=await t.ondata(r),a=n.length,o=c+n.buffer.byteLength;e.byteLength<o&&e.grow(o),s.set(n,2),s[1]=a,s[0]=1}})(a,t);n.addEventListener("message",async({data:[e,t]})=>{await g({data:t}),n.postMessage([e,d.slice(0,2+d[1])])}),super(...((e,t,s)=>{const r=new URL(e,location.href);return r.searchParams.set("reflected",t),[r,{...s,type:"module"}]})(e,p,t)),super.addEventListener("message",()=>s(this),{once:!0}),super.postMessage(((e,t)=>{const s={};for(const e in t){const r=t[e];i(e)&&i(r)&&(s[e]=r)}return[e,s]})(a,t).concat(r))}get channel(){return p}});const{isArray:y}=Array;const{promise:l,resolve:h}=t();addEventListener("message",({data:[e,t,s]})=>h([e,t,s]),{once:!0});const m="async";var w="importScripts"in globalThis?e=>l.then(([n,a,o])=>(postMessage(1),((e,r,n)=>{const a=new BroadcastChannel(e),o=s(),c=new Map;return a.addEventListener("message",({data:[e,t]})=>{const[s,a]=c.get(e);r.set(t,0),s(n.ondata(r.subarray(2,2+r[1])))}),(e,...s)=>{const{promise:r,resolve:n}=t(),i=o();return c.set(i,[n,s]),a.postMessage([i,e],...s),r}})(o,new Int32Array(n),(e=>(addEventListener("message",async t=>{const{data:s}=t;if(y(s)&&s[0]===r){t.stopImmediatePropagation(),t.preventDefault();const[n,a]=s[1];postMessage([r,[n,await e.onsend(a)]])}}),e))({...a,...e})))):g;export{m as channel,w as default};
