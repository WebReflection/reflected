const e=Promise.withResolvers||function(){var e,t,s=new this((s,n)=>{e=s,t=n});return{resolve:e,reject:t,promise:s}};var t=e.bind(Promise),s=e=>{const t=new Int32Array(1);return()=>t[0]++},n="fc260aad-4404-43b8-ae9d-2c06554bb294";const{isArray:r}=Array,a=e=>e;class o extends Worker{#e;#t;constructor(e,t){super(e,t),this.#e=s(),this.#t=new Map,t.onsend||(t.onsend=a),super.addEventListener("message",async e=>{const{data:s}=e;if(r(s)&&2===s.length&&s[0]===n){e.stopImmediatePropagation(),e.preventDefault();const[n,r]=s[1],a=this.#t.get(n);this.#t.delete(n),a(await t.onsend(r))}})}send(e,...s){const r=this.#e(),{promise:a,resolve:o}=t();return this.#t.set(r,o),super.postMessage([n,[r,e]],...s),a}}let{SharedArrayBuffer:c}=globalThis;try{new c(4,{maxByteLength:8})}catch(e){c=class extends ArrayBuffer{get growable(){return super.resizable}grow(e){super.resize(e)}}}const i=2*Int32Array.BYTES_PER_ELEMENT;let u=!0;try{crypto.randomUUID()}catch(e){u=!1}const l=u?()=>crypto.randomUUID():()=>(Date.now()+Math.random()).toString(36);let h=0;const p=h++,f=h++,y=h++,g=h++,d=h++,b=h++,w=h++,m=h++,v=h++,A=h++,k=h++,S=h++,B=h++,U=h++,M=h++,x=h++,E=h++,L=h++,I=h++,T=h++,O=h++,D=h++,P=h++,F=h++,N=h++,R=h++,j=h++,q=h++;const z=globalThis.ImageData||class{};class _{static push(e,t){e.sync(!1),e._(t,t.length)}constructor(e,t){const s=[];this.l=0,this.o=s,this.v=new Uint8Array(e,t),this.push=s.push.bind(s)}get length(){return this.l+this.o.length}sync(e){const t=this.o,s=t.length;s&&this._(e?t:t.splice(0),s)}_(e,t){const{buffer:s,byteOffset:n}=this.v,r=this.l;this.l+=t,t+=n+r,s.byteLength<t&&s.grow(t),this.v.set(e,r)}}const $=new Map(Reflect.ownKeys(Symbol).map(e=>[Symbol[e],`@${String(e)}`])),C=e=>$.get(e)||((e,t)=>void 0===t?"?":void 0===Symbol.keyFor(e)?`!${t}`:`#${t}`)(e,e.description),J=Object.defineProperty,K=Array.isArray,V=ArrayBuffer.isView,W=new TextDecoder,Y=new TextEncoder,G=new ArrayBuffer(8),H=new DataView(G),Q=new Uint8Array(G),{getPrototypeOf:X}=Object,{construct:Z}=Reflect,{toStringTag:ee}=Symbol,te=(e,t=e[ee])=>t in globalThis?t:te(Z(X(e.constructor),[0])),{isNaN:se,isFinite:ne,isInteger:re}=Number,{ownKeys:ae}=Reflect,{is:oe}=Object,ce=(e,t,s)=>{const n=s.get(e),r=!n;return r?(H.setUint32(0,t.length,!0),s.set(e,[Q[0],Q[1],Q[2],Q[3]])):t.push(q,n[0],n[1],n[2],n[3]),r},ie=(e,t,s)=>{H.setUint32(0,s,!0),e.push(t,Q[0],Q[1],Q[2],Q[3])},ue=(e,t,s)=>{switch(typeof e){case"number":e&&ne(e)?re(e)&&e<256&&-1<e?t.push(b,e):(H.setFloat64(0,e,!0),t.push(d,Q[0],Q[1],Q[2],Q[3],Q[4],Q[5],Q[6],Q[7])):se(e)?t.push(w):e?t.push(e<0?v:m):t.push(oe(e,0)?A:k);break;case"object":switch(!0){case null===e:t.push(g);break;case!ce(e,t,s):break;case K(e):{const n=e.length;ie(t,x,n);for(let r=0;r<n;r++)ue(e[r],t,s);break}case V(e):if(t.push(F),ue(te(e),t,s),e=e.buffer,!ce(e,t,s))break;case e instanceof ArrayBuffer:{const s=new Uint8Array(e);ie(t,E,s.length),he(t,s);break}case e instanceof Date:t.push(L),ue(e.getTime(),t,s);break;case e instanceof Map:ie(t,T,e.size);for(const[n,r]of e)ue(n,t,s),ue(r,t,s);break;case e instanceof Set:ie(t,P,e.size);for(const n of e)ue(n,t,s);break;case e instanceof Error:t.push(I),ue(e.name,t,s),ue(e.message,t,s),ue(e.stack,t,s);break;case e instanceof z:t.push(N),ue(e.data,t,s),ue(e.width,t,s),ue(e.height,t,s),ue(e.colorSpace,t,s),ue(e.pixelFormat,t,s);break;case e instanceof RegExp:t.push(D),ue(e.source,t,s),ue(e.flags,t,s);break;case e instanceof File:t.push(j),ue(e.name,t,s),ue(e.lastModified,t,s);case e instanceof Blob:{const n=e.size;t.push(R),ue(e.type,t,s),ue(n,t,s);const r=t.length;he(t,new Uint8Array(n)),le.push(e.arrayBuffer().then(e=>[r,e]));break}default:if("toJSON"in e){const n=e.toJSON();ue(n===e?null:n,t,s)}else{const n=ae(e),r=n.length;ie(t,O,r);for(let a=0;a<r;a++){const r=n[a];ue(r,t,s),ue(e[r],t,s)}}}break;case"string":if(ce(e,t,s)){const s=Y.encode(e);ie(t,U,s.length),he(t,s)}break;case"boolean":t.push(e?f:p);break;case"symbol":t.push(M),ue(C(e),t,s);break;case"bigint":{let s=S;9223372036854775807n<e?(H.setBigUint64(0,e,!0),s=B):H.setBigInt64(0,e,!0),t.push(s,Q[0],Q[1],Q[2],Q[3],Q[4],Q[5],Q[6],Q[7]);break}default:t.push(y)}},le=[];let he=(e,t)=>{for(let s=e.push,n=0,r=t.length;n<r;n+=32767)s.apply(e,t.subarray(n,n+32767))};const pe=({byteOffset:e=0,Array:t=_}={})=>(s,n)=>{const r=new t(n,e);he=t.push,ue(s,r,new Map);const a=r.length;return r.sync(!0),le.length?Promise.all(le.splice(0)).then(t=>{const s=new Uint8Array(n,e);for(const[e,n]of t)s.set(new Uint8Array(n),e);return a}):a},fe=(e,t,s)=>{const n=new Int32Array(e),r=(t.encoder??pe)({byteOffset:i}),a=e=>{n[1]=e,n[0]=1};return async({data:s})=>(t=>{const s=r(t,e);return"number"==typeof s?a(s):s.then(a)})(await t.onsync(s))},ye=e=>{switch(typeof e){case"symbol":case"function":return!1}return!0},ge="async";var de=(e=>(s,n)=>{const{promise:r,resolve:a}=t();return new e(s,n,a),r})(class extends o{constructor(e,t,s){const n=l(),r=new BroadcastChannel(n),a=(({initByteLength:e=1024,maxByteLength:t=8192})=>new c(i+e,{maxByteLength:i+t}))(t),o=new Int32Array(a),u=fe(a,t);r.addEventListener("message",async({data:[e,t]})=>{await u({data:t}),r.postMessage([e,new Uint8Array(a,i,o[1])])}),super(...((e,t,s)=>{const n=new URL(e,location.href);return n.searchParams.set("reflected",t),[n,{...s,type:"module"}]})(e,ge,t)),super.addEventListener("message",()=>s(this),{once:!0}),super.postMessage(((e,t)=>{const s={};for(const e in t){const n=t[e];ye(e)&&ye(n)&&(s[e]=n)}return[e,s]})(a,t).concat(n))}get channel(){return ge}});const be=(e,t,s)=>(e.set(t,s),s),we=e=>{Q[0]=e[Ae++],Q[1]=e[Ae++],Q[2]=e[Ae++],Q[3]=e[Ae++],Q[4]=e[Ae++],Q[5]=e[Ae++],Q[6]=e[Ae++],Q[7]=e[Ae++]},me=e=>(Q[0]=e[Ae++],Q[1]=e[Ae++],Q[2]=e[Ae++],Q[3]=e[Ae++],H.getUint32(0,!0)),ve=(e,t)=>{switch(e[Ae++]){case d:return we(e),H.getFloat64(0,!0);case b:return e[Ae++];case O:{const s=be(t,Ae-1,{});for(let n=0,r=me(e);n<r;n++)s[ve(e,t)]=ve(e,t);return s}case x:{const s=be(t,Ae-1,[]);for(let n=0,r=me(e);n<r;n++)s.push(ve(e,t));return s}case F:{const s=Ae-1,n=ve(e,t);return be(t,s,new globalThis[n](ve(e,t)))}case E:{const s=Ae-1,n=me(e);return be(t,s,e.slice(Ae,Ae+=n).buffer)}case U:{const s=Ae-1,n=me(e);return be(t,s,W.decode(e.slice(Ae,Ae+=n)))}case L:return be(t,Ae-1,new Date(ve(e,t)));case T:{const s=be(t,Ae-1,new Map);for(let n=0,r=me(e);n<r;n++)s.set(ve(e,t),ve(e,t));return s}case P:{const s=be(t,Ae-1,new Set);for(let n=0,r=me(e);n<r;n++)s.add(ve(e,t));return s}case I:{const s=ve(e,t),n=ve(e,t),r=ve(e,t),a=new(globalThis[s]||Error)(n);return be(t,Ae-1,J(a,"stack",{value:r}))}case N:{const s=ve(e,t),n=ve(e,t),r=ve(e,t),a=ve(e,t),o=ve(e,t);return be(t,Ae-1,new z(s,n,r,{colorSpace:a,pixelFormat:o}))}case D:{const s=ve(e,t),n=ve(e,t);return be(t,Ae-1,new RegExp(s,n))}case p:return!1;case f:return!0;case w:return NaN;case m:return 1/0;case v:return-1/0;case A:return 0;case k:return-0;case g:return null;case S:return we(e),H.getBigInt64(0,!0);case B:return we(e),H.getBigUint64(0,!0);case M:return(e=>{switch(e[0]){case"@":return Symbol[e.slice(1)];case"#":return Symbol.for(e.slice(1));case"!":return Symbol(e.slice(1));default:return Symbol()}})(ve(e,t));case q:return t.get(me(e));case R:{const s=ve(e,t),n=ve(e,t);return be(t,Ae-1,new Blob([e.slice(Ae,Ae+=n)],{type:s}))}case j:{const s=Ae-1,n=ve(e,t),r=ve(e,t),a=ve(e,t);return be(t,s,new File([a],n,{type:a.type,lastModified:r}))}default:return}};let Ae=0;const ke=({byteOffset:e=0}={})=>(t,s)=>{return n=new Uint8Array(s,e,t),Ae=0,ve(n,new Map);var n},{isArray:Se}=Array;const{promise:Be,resolve:Ue}=t();addEventListener("message",({data:[e,t,s]})=>Ue([t,s]),{once:!0});const Me="async";var xe="importScripts"in globalThis?e=>Be.then(([r,a])=>(postMessage(1),((e,n)=>{const r=new BroadcastChannel(e),a=s(),o=(n.decoder??ke)({byteOffset:i}),c=new Map;return r.addEventListener("message",({data:[e,{length:t,buffer:s}]})=>{c.get(e)(n.onsync(t?o(t,s):void 0)),c.delete(e)}),(e,...s)=>{const{promise:n,resolve:o}=t(),i=a();return c.set(i,o),r.postMessage([i,e],...s),n}})(a,(e=>(addEventListener("message",async t=>{const{data:s}=t;if(Se(s)&&s[0]===n){t.stopImmediatePropagation(),t.preventDefault();const[r,a]=s[1];postMessage([n,[r,await e.onsend(a)]])}}),e))({...r,...e})))):de;export{Me as channel,xe as default};
