const e=Promise.withResolvers||function(){var e,t,s=new this((s,n)=>{e=s,t=n});return{resolve:e,reject:t,promise:s}};var t=e.bind(Promise),s="fc260aad-4404-43b8-ae9d-2c06554bb294";const{isArray:n}=Array,r=e=>e;class a extends Worker{#e;#t;constructor(e,t){super(e,t),this.#e=(()=>{const e=new Int32Array(1);return()=>e[0]++})(),this.#t=new Map,t.onsend||(t.onsend=r),super.addEventListener("message",async e=>{const{data:r}=e;if(n(r)&&r[0]===s){e.stopImmediatePropagation(),e.preventDefault();const[s,n]=r[1],a=this.#t.get(s);this.#t.delete(s),a(await t.onsend(n))}})}send(e,...n){const r=this.#e(),{promise:a,resolve:o}=t();return this.#t.set(r,o),super.postMessage([s,[r,e]],...n),a}}let o=0;const c=o++,i=o++,u=o++,l=o++,h=o++,f=o++,p=o++,y=o++,d=o++,g=o++,b=o++,w=o++,m=o++,v=o++,A=o++,k=o++,S=o++,B=o++,U=o++,E=o++,M=o++,x=o++,I=o++,L=o++,O=o++,T=o++,D=o++,P=o++;const F=globalThis.ImageData||class{};class N{static push(e,t){e.sync(!1),e._(t,t.length)}constructor(e,t){const s=[];this.l=0,this.o=s,this.v=new Uint8Array(e,t),this.push=s.push.bind(s)}get length(){return this.l+this.o.length}sync(e){const t=this.o,s=t.length;s&&this._(e?t:t.splice(0),s)}_(e,t){const{buffer:s,byteOffset:n}=this.v,r=this.l;this.l+=t,t+=n+r,s.byteLength<t&&s.grow(t),this.v.set(e,r)}}const R=new Map(Reflect.ownKeys(Symbol).map(e=>[Symbol[e],`@${String(e)}`])),j=e=>R.get(e)||((e,t)=>void 0===t?"?":void 0===Symbol.keyFor(e)?`!${t}`:`#${t}`)(e,e.description),q=Object.defineProperty,_=Array.isArray,z=ArrayBuffer.isView,$=new TextDecoder,C=new TextEncoder,J=new ArrayBuffer(8),K=new DataView(J),V=new Uint8Array(J),{getPrototypeOf:W}=Object,{construct:Y}=Reflect,{toStringTag:G}=Symbol,H=(e,t=e[G])=>t in globalThis?t:H(Y(W(e.constructor),[0])),{isNaN:Q,isFinite:X,isInteger:Z}=Number,{ownKeys:ee}=Reflect,{is:te}=Object,se=(e,t,s)=>{const n=s.get(e),r=!n;return r?(K.setUint32(0,t.length,!0),s.set(e,[V[0],V[1],V[2],V[3]])):t.push(P,n[0],n[1],n[2],n[3]),r},ne=(e,t,s)=>{K.setUint32(0,s,!0),e.push(t,V[0],V[1],V[2],V[3])},re=(e,t,s)=>{switch(typeof e){case"number":e&&X(e)?Z(e)&&e<256&&-1<e?t.push(f,e):(K.setFloat64(0,e,!0),t.push(h,V[0],V[1],V[2],V[3],V[4],V[5],V[6],V[7])):Q(e)?t.push(p):e?t.push(e<0?d:y):t.push(te(e,0)?g:b);break;case"object":switch(!0){case null===e:t.push(l);break;case!se(e,t,s):break;case _(e):{const n=e.length;ne(t,k,n);for(let r=0;r<n;r++)re(e[r],t,s);break}case z(e):if(t.push(L),re(H(e),t,s),e=e.buffer,!se(e,t,s))break;case e instanceof ArrayBuffer:{const s=new Uint8Array(e);ne(t,S,s.length),oe(t,s);break}case e instanceof Date:t.push(B),re(e.getTime(),t,s);break;case e instanceof Map:ne(t,E,e.size);for(const[n,r]of e)re(n,t,s),re(r,t,s);break;case e instanceof Set:ne(t,I,e.size);for(const n of e)re(n,t,s);break;case e instanceof Error:t.push(U),re(e.name,t,s),re(e.message,t,s),re(e.stack,t,s);break;case e instanceof F:t.push(O),re(e.data,t,s),re(e.width,t,s),re(e.height,t,s),re(e.colorSpace,t,s),re(e.pixelFormat,t,s);break;case e instanceof RegExp:t.push(x),re(e.source,t,s),re(e.flags,t,s);break;case e instanceof File:t.push(D),re(e.name,t,s),re(e.lastModified,t,s);case e instanceof Blob:{const n=e.size;t.push(T),re(e.type,t,s),re(n,t,s);const r=t.length;oe(t,new Uint8Array(n)),ae.push(e.arrayBuffer().then(e=>[r,e]));break}default:if("toJSON"in e){const n=e.toJSON();re(n===e?null:n,t,s)}else{const n=ee(e),r=n.length;ne(t,M,r);for(let a=0;a<r;a++){const r=n[a];re(r,t,s),re(e[r],t,s)}}}break;case"string":if(se(e,t,s)){const s=C.encode(e);ne(t,v,s.length),oe(t,s)}break;case"boolean":t.push(e?i:c);break;case"symbol":t.push(A),re(j(e),t,s);break;case"bigint":{let s=w;9223372036854775807n<e?(K.setBigUint64(0,e,!0),s=m):K.setBigInt64(0,e,!0),t.push(s,V[0],V[1],V[2],V[3],V[4],V[5],V[6],V[7]);break}default:t.push(u)}},ae=[];let oe=(e,t)=>{for(let s=e.push,n=0,r=t.length;n<r;n+=32767)s.apply(e,t.subarray(n,n+32767))};const ce=({byteOffset:e=0,Array:t=N}={})=>(s,n)=>{const r=new t(n,e);oe=t.push,re(s,r,new Map);const a=r.length;return r.sync(!0),ae.length?Promise.all(ae.splice(0)).then(t=>{const s=new Uint8Array(n,e);for(const[e,n]of t)s.set(new Uint8Array(n),e);return a}):a},ie=2*Int32Array.BYTES_PER_ELEMENT;let ue=!0;try{crypto.randomUUID()}catch(e){ue=!1}const le=ue?()=>crypto.randomUUID():()=>(Date.now()+Math.random()).toString(36),{notify:he,store:fe}=Atomics,pe=(e,t,s)=>{const n=new Int32Array(e),r=(t.encoder??ce)({byteOffset:ie}),a=e=>{fe(n,1,e),fe(n,0,1),he(n,0)};return async({data:s})=>(t=>{const s=r(t,e);return"number"==typeof s?a(s):s.then(a)})(await t.onsync(s))},ye=e=>{switch(typeof e){case"symbol":case"function":return!1}return!0},de="broadcast";var ge=(e=>(s,n)=>{const{promise:r,resolve:a}=t();return new e(s,n,a),r})(class extends a{constructor(e,t,s){const n=le(),r=new BroadcastChannel(n),a=(({initByteLength:e=1024,maxByteLength:t=8192})=>new SharedArrayBuffer(ie+e,{maxByteLength:ie+t}))(t);r.addEventListener("message",pe(a,t)),super(...((e,t,s)=>{const n=new URL(e,location.href);return n.searchParams.set("reflected",t),[n,{...s,type:"module"}]})(e,de,t)),super.addEventListener("message",()=>s(this),{once:!0}),super.postMessage(((e,t)=>{const s={};for(const e in t){const n=t[e];ye(e)&&ye(n)&&(s[e]=n)}return[e,s]})(a,t).concat(n))}get channel(){return de}});const be=(e,t,s)=>(e.set(t,s),s),we=e=>{V[0]=e[Ae++],V[1]=e[Ae++],V[2]=e[Ae++],V[3]=e[Ae++],V[4]=e[Ae++],V[5]=e[Ae++],V[6]=e[Ae++],V[7]=e[Ae++]},me=e=>(V[0]=e[Ae++],V[1]=e[Ae++],V[2]=e[Ae++],V[3]=e[Ae++],K.getUint32(0,!0)),ve=(e,t)=>{switch(e[Ae++]){case h:return we(e),K.getFloat64(0,!0);case f:return e[Ae++];case M:{const s=be(t,Ae-1,{});for(let n=0,r=me(e);n<r;n++)s[ve(e,t)]=ve(e,t);return s}case k:{const s=be(t,Ae-1,[]);for(let n=0,r=me(e);n<r;n++)s.push(ve(e,t));return s}case L:{const s=Ae-1,n=ve(e,t);return be(t,s,new globalThis[n](ve(e,t)))}case S:{const s=Ae-1,n=me(e);return be(t,s,e.slice(Ae,Ae+=n).buffer)}case v:{const s=Ae-1,n=me(e);return be(t,s,$.decode(e.slice(Ae,Ae+=n)))}case B:return be(t,Ae-1,new Date(ve(e,t)));case E:{const s=be(t,Ae-1,new Map);for(let n=0,r=me(e);n<r;n++)s.set(ve(e,t),ve(e,t));return s}case I:{const s=be(t,Ae-1,new Set);for(let n=0,r=me(e);n<r;n++)s.add(ve(e,t));return s}case U:{const s=ve(e,t),n=ve(e,t),r=ve(e,t),a=new(globalThis[s]||Error)(n);return be(t,Ae-1,q(a,"stack",{value:r}))}case O:{const s=ve(e,t),n=ve(e,t),r=ve(e,t),a=ve(e,t),o=ve(e,t);return be(t,Ae-1,new F(s,n,r,{colorSpace:a,pixelFormat:o}))}case x:{const s=ve(e,t),n=ve(e,t);return be(t,Ae-1,new RegExp(s,n))}case c:return!1;case i:return!0;case p:return NaN;case y:return 1/0;case d:return-1/0;case g:return 0;case b:return-0;case l:return null;case w:return we(e),K.getBigInt64(0,!0);case m:return we(e),K.getBigUint64(0,!0);case A:return(e=>{switch(e[0]){case"@":return Symbol[e.slice(1)];case"#":return Symbol.for(e.slice(1));case"!":return Symbol(e.slice(1));default:return Symbol()}})(ve(e,t));case P:return t.get(me(e));case T:{const s=ve(e,t),n=ve(e,t);return be(t,Ae-1,new Blob([e.slice(Ae,Ae+=n)],{type:s}))}case D:{const s=Ae-1,n=ve(e,t),r=ve(e,t),a=ve(e,t);return be(t,s,new File([a],n,{type:a.type,lastModified:r}))}default:return}};let Ae=0;const ke=({byteOffset:e=0}={})=>(t,s)=>{return n=new Uint8Array(s,e,t),Ae=0,ve(n,new Map);var n},{isArray:Se}=Array;const{load:Be,store:Ue,wait:Ee}=Atomics,{promise:Me,resolve:xe}=t(),Ie="broadcast";var Le=((e,t)=>(addEventListener("message",t,{once:!0}),t=>e.then(([e,n,r])=>(postMessage(1),((e,t,s)=>{const n=(s.decoder??ke)({byteOffset:ie}),{buffer:r}=t;return(a,...o)=>{e.postMessage(a,...o),Ee(t,0,0),Ue(t,0,0);const c=Be(t,1);return s.onsync(c?n(c,r):void 0)}})(r,new Int32Array(e),(e=>(addEventListener("message",async t=>{const{data:n}=t;if(Se(n)&&n[0]===s){t.stopImmediatePropagation(),t.preventDefault();const[r,a]=n[1];postMessage([s,[r,await e.onsend(a)]])}}),e))({...n,...t}))))))(Me,({data:[e,t,s]})=>xe([e,t,new BroadcastChannel(s)])),Oe="importScripts"in globalThis?Le:ge;export{Ie as channel,Oe as default};
