const e=Promise.withResolvers||function(){var e,t,s=new this((s,r)=>{e=s,t=r});return{resolve:e,reject:t,promise:s}};var t=e.bind(Promise),s="353932a0-9595-4ff9-9b6b-53b3f14ebbe3";const{isArray:r}=Array;class n extends Worker{#e;#t;constructor(e,t){super(e,t),this.#e=(()=>{const e=new Int32Array(1);return()=>e[0]++})(),this.#t=new Map,super.addEventListener("message",async e=>{const{data:n}=e;if(r(n)&&n[0]===s){e.stopImmediatePropagation(),e.preventDefault();const[s,r]=n[1],[a,o]=this.#t.get(s);this.#t.delete(s),a(await t.onsend(r,...o))}})}send(e,...r){const n=this.#e(),{promise:a,resolve:o}=t();return this.#t.set(n,[o,r]),super.postMessage([s,[n,e]],...r),a}}const{notify:a,store:o}=Atomics,c=2*Int32Array.BYTES_PER_ELEMENT,i=e=>{switch(typeof e){case"symbol":case"function":return!1}return!0};let d=!0;try{crypto.randomUUID()}catch(e){d=!1}const u=d?()=>crypto.randomUUID():()=>(Date.now()+Math.random()).toString(36),p="broadcast";var h=(e=>(s,r)=>{const{promise:n,resolve:a}=t();return new e(s,r,a),n})(class extends n{constructor(e,t,s){const r=u(),n=new BroadcastChannel(r),d=(({initByteLength:e=1024,maxByteLength:t=8192})=>new SharedArrayBuffer(c+e,{maxByteLength:c+t}))(t);n.addEventListener("message",((e,t)=>{const s=new Int32Array(e);return async({data:r})=>{const n=await t.ondata(r),i=n.length,d=c+n.buffer.byteLength;e.byteLength<d&&e.grow(d),s.set(n,2),o(s,1,i),o(s,0,1),a(s,0)}})(d,t)),super(...((e,t,s)=>{const r=new URL(e,location.href);return r.searchParams.set("reflected",t),[r,{...s,type:"module"}]})(e,p,t)),super.addEventListener("message",()=>s(this),{once:!0}),super.postMessage(((e,t)=>{const s={};for(const e in t){const r=t[e];i(e)&&i(r)&&(s[e]=r)}return[e,s]})(d,t).concat(r))}get channel(){return p}});const{isArray:m}=Array;const{load:y,store:g,wait:l}=Atomics,{promise:f,resolve:w}=t(),v="broadcast";var b=((e,t)=>(addEventListener("message",t,{once:!0}),t=>e.then(([e,r,n])=>(postMessage(1),((e,t,s)=>(r,...n)=>(e.postMessage(r,...n),l(t,0,0),g(t,0,0),s.ondata(t.subarray(2,2+y(t,1)))))(n,new Int32Array(e),(e=>(addEventListener("message",async t=>{const{data:r}=t;if(m(r)&&r[0]===s){t.stopImmediatePropagation(),t.preventDefault();const[n,a]=r[1];postMessage([s,[n,await e.onsend(a)]])}}),e))({...r,...t}))))))(f,({data:[e,t,s]})=>w([e,t,new BroadcastChannel(s)])),L="importScripts"in globalThis?b:h;export{v as channel,L as default};
