import{w as e}from"./with-resolvers-CHEvl4oe.js";import{i as t}from"./i32-C78nBJH2.js";import{S as s}from"./channel-Bt2ZBEfg.js";const{isArray:r}=Array;class n extends Worker{#e;#t;constructor(e,n){super(e,n),this.#e=t(),this.#t=new Map,super.addEventListener("message",async e=>{const{data:t}=e;if(r(t)&&t[0]===s){e.stopImmediatePropagation(),e.preventDefault();const[s,r]=t[1],[a,o]=this.#t.get(s);this.#t.delete(s),a(await n.onsend(r,...o))}})}send(t,...r){const n=this.#e(),{promise:a,resolve:o}=e();return this.#t.set(n,[o,r]),super.postMessage([s,[n,t]],...r),a}}const{notify:a,store:o}=Atomics,i=2*Int32Array.BYTES_PER_ELEMENT,c=({initByteLength:e=1024,maxByteLength:t=8192})=>new SharedArrayBuffer(i+e,{maxByteLength:i+t}),u=t=>(s,r)=>{const{promise:n,resolve:a}=e();return new t(s,r,a),n},h=(e,t,s)=>{const r=new Int32Array(e);return async({data:n})=>{const c=await t.ondata(n),u=c.length,h=i+c.buffer.byteLength;e.byteLength<h&&e.grow(h),r.set(c,2),s?(o(r,1,u),o(r,0,1),a(r,0)):(r[1]=u,r[0]=1)}},m=e=>{switch(typeof e){case"symbol":case"function":return!1}return!0},p=(e,t)=>{const s={};for(const e in t){const r=t[e];m(e)&&m(r)&&(s[e]=r)}return[e,s]},y=(e,t,s)=>{const r=new URL(e,location.href);return r.searchParams.set("reflected",t),[r,{...s,type:"module"}]};export{n as S,c as a,u as b,h,i as m,p,y as u};
