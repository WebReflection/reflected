import{w as e}from"./with-resolvers-CHEvl4oe.js";import{i as t}from"./i32-C78nBJH2.js";import{S as s}from"./channel-BXT2nbj7.js";const{isArray:r}=Array,n=e=>e;class a extends Worker{#e;#t;constructor(e,a){super(e,a),this.#e=t(),this.#t=new Map,a.onsend||(a.onsend=n),super.addEventListener("message",async e=>{const{data:t}=e;if(r(t)&&t[0]===s){e.stopImmediatePropagation(),e.preventDefault();const[s,r]=t[1],n=this.#t.get(s);this.#t.delete(s),n(await a.onsend(r))}})}send(t,...r){const n=this.#e(),{promise:a,resolve:o}=e();return this.#t.set(n,o),super.postMessage([s,[n,t]],...r),a}}const{notify:o,store:i}=Atomics,c=2*Int32Array.BYTES_PER_ELEMENT,u=({initByteLength:e=1024,maxByteLength:t=8192})=>new SharedArrayBuffer(c+e,{maxByteLength:c+t}),h=t=>(s,r)=>{const{promise:n,resolve:a}=e();return new t(s,r,a),n},m=(e,t,s)=>{const r=new Int32Array(e);return async({data:n})=>{const a=await t.ondata(n),u=a.length,h=c+a.buffer.byteLength;e.byteLength<h&&e.grow(h),r.set(a,2),s?(i(r,1,u),i(r,0,1),o(r,0)):(r[1]=u,r[0]=1)}},p=e=>{switch(typeof e){case"symbol":case"function":return!1}return!0},d=(e,t)=>{const s={};for(const e in t){const r=t[e];p(e)&&p(r)&&(s[e]=r)}return[e,s]},y=(e,t,s)=>{const r=new URL(e,location.href);return r.searchParams.set("reflected",t),[r,{...s,type:"module"}]};export{a as S,u as a,h as b,m as h,c as m,d as p,y as u};
